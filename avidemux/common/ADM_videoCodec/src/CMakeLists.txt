MACRO(ADD_IF_ENABLED x)
  TARGET_SOURCES(ADM_videoCodec6 PRIVATE ${ARGN})
ENDMACRO()

ADD_LIBRARY(ADM_videoCodec6 STATIC )
TARGET_LINK_LIBRARIES(ADM_videoCodec6 PRIVATE ADM_render6_interface)
target_include_directories(ADM_videoCodec6 PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/../include)

TARGET_SOURCES(ADM_videoCodec6 PRIVATE
        ADM_videoCodec.cpp
        ADM_dynVideoDecoder.cpp)


IF(USE_VDPAU)
  ADD_CORE_INCLUDE(ADM_coreVdpau)
  ADD_IF_ENABLED(USE_VDPAU ADM_ffmpeg_vdpau.cpp)
ENDIF()

IF(USE_LIBVA)
  ADD_DEFINITIONS(${LIBVA_CFLAGS})
  TARGET_INCLUDE_DIRECTORIES(ADM_videoCodec6 PRIVATE ${LIBVA_INCLUDE_DIR})
  ADD_CORE_INCLUDE(ADM_coreLibVA)
  ADD_IF_ENABLED(USE_LIBVA ADM_ffmpeg_libva.cpp)
ENDIF()
IF(USE_DXVA2)
  ADD_DEFINITIONS(${LIBVA_CFLAGS})
  TARGET_INCLUDE_DIRECTORIES(ADM_videoCodec6 PRIVATE ../../ADM_render/ADM_coreDxva2/include/) # TEMPORARY
  ADD_CORE_INCLUDE(ADM_coreDxva2)
  ADD_IF_ENABLED(USE_LIBVA ADM_ffmpeg_dxva2.cpp)
ENDIF()
IF(USE_VIDEOTOOLBOX)
  ADD_IF_ENABLED(USE_VIDEOTOOLBOX ADM_ffmpeg_videotoolbox.cpp)
ENDIF()
IF(USE_NVENC)
  ADD_DEFINITIONS(${FFNVENC_CFLAGS})
  TARGET_INCLUDE_DIRECTORIES(ADM_videoCodec6 PRIVATE ${NVENC_INCLUDE_DIR})
  ADD_IF_ENABLED(USE_NVENC ADM_ffmpeg_nvdec.cpp)
  IF(UNIX AND NOT APPLE)
    TARGET_LINK_LIBRARIES(ADM_videoCodec6 PRIVATE "-ldl")
  ENDIF()
ENDIF()

